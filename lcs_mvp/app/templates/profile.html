{% extends "base.html" %}
{% block content %}
<h1>Profile</h1>
<p class="muted">MVP demo profile. Edit your display name, bio, avatar, and (for now) self-select domains.</p>

{% if msg %}
  <div class="callout" style="border-left:4px solid #14532d">
    <b>Saved</b>
    <div class="muted" style="margin-top:6px">{{ msg }}</div>
  </div>
{% endif %}

<div class="card" style="margin-bottom:16px">
  <h2 style="margin-top:0">Identity</h2>
  <form method="post" action="/profile/save" enctype="multipart/form-data" class="grid" style="grid-template-columns: 1fr 280px; gap: 14px">
    <div>
      <label>Username</label>
      <input value="{{ user.username }}" disabled />

      <label>Display name</label>
      <input name="display_name" value="{{ user.display_name }}" placeholder="Robin Johnson" />

      <label>Bio</label>
      <textarea name="bio" rows="4" placeholder="Short role/context for demos">{{ user.bio }}</textarea>
    </div>

    <div>
      <label>Avatar</label>
      {% if user.avatar_path %}
        <div class="card" style="padding:10px">
          <img src="/profile/avatar" alt="avatar" style="width:100%; border-radius:12px; border:1px solid var(--border)" />
          <div class="muted" style="margin-top:8px">Stored: <code>{{ user.avatar_path }}</code></div>
        </div>
      {% else %}
        <div class="muted">No avatar uploaded.</div>
      {% endif %}

      <div style="margin-top:10px">
        <input type="file" name="avatar" accept="image/png,image/jpeg,image/webp" />
        <div class="muted" style="margin-top:6px">PNG/JPG/WebP. Stored locally on the server.</div>
      </div>
    </div>

    <div style="grid-column:1 / -1">
      <button class="btn" type="submit">Save profile</button>
    </div>
  </form>
</div>

<div class="card">
  <h2 style="margin-top:0">Domains (self-select for demo)</h2>
  <p class="muted">This is temporary. Eventually domain entitlements should be managed by admins/policy.</p>

  <form method="post" action="/profile/domains/save">
    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px">
      {% for d in domains %}
        <label class="check" style="margin:0">
          <input type="checkbox" name="domain" value="{{ d }}" {% if d in selected %}checked{% endif %} />
          <span>{{ d }}</span>
        </label>
      {% endfor %}
    </div>
    <div style="margin-top:12px">
      <button class="btn secondary" type="submit">Save domains</button>
    </div>
  </form>
</div>

{% endblock %}
