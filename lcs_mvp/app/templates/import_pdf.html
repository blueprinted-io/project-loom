{% extends "base.html" %}
{% block content %}
<h1>Import Tasks from PDF (AI-assisted)</h1>

{% if error %}
<div class="callout danger">
  <b>Import failed:</b> {{ error }}
</div>
{% endif %}

<div class="callout warn">
  <b>Trust boundary:</b> Imported Tasks are always created as <b>draft</b> and flagged for review. Nothing is auto-confirmed.
</div>

<div class="card">
  <p class="muted">LM Studio base URL: <code>{{ lmstudio_base_url }}</code></p>
  <p class="muted">Model: <code>{{ lmstudio_model }}</code></p>
  <p class="muted">Override via env vars: <code>LCS_LMSTUDIO_BASE_URL</code>, <code>LCS_LMSTUDIO_MODEL</code></p>
</div>

{% if ingestions %}
<div class="card">
  <h2 style="margin-top:0">Previous ingestions</h2>
  <p class="muted">Resume from where you left off. Progress is keyed by document hash, not filename.</p>
  <table class="table">
    <thead><tr><th>File</th><th>Created</th><th>Status</th><th>Cursor</th><th></th></tr></thead>
    <tbody>
      {% for i in ingestions %}
      <tr>
        <td>{{ i.filename }}</td>
        <td class="muted">{{ i.created_at }}</td>
        <td><span class="badge">{{ i.status }}</span></td>
        <td class="muted">chunk {{ i.cursor_chunk }}</td>
        <td><a class="btn" href="/import/pdf/run?ingestion_id={{ i.id }}">Resume</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

<form method="post" action="/import/pdf/prepare" enctype="multipart/form-data" class="card">
  <label>PDF file</label>
  <input type="file" name="pdf" accept="application/pdf" required />

  <label>Max tasks to propose (per run)</label>
  <input type="number" name="max_tasks" value="10" min="1" max="10" />

  <label>Max chunks to process (per run)</label>
  <input type="number" name="max_chunks" value="8" min="1" max="20" />

  <label>Import note</label>
  <input name="actor_note" value="Imported from PDF" />

  <button class="btn" type="submit">Generate candidates</button>
</form>

<p class="muted">MVP notes: author/admin only. Import creates a candidate list first; nothing is written until you select items.</p>
{% endblock %}
