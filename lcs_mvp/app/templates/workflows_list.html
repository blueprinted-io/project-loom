{% extends "base.html" %}
{% block content %}
<div class="row">
  <h1>Workflows</h1>
  <div>
    {% if can(request.state.role, 'workflow:create') %}
      <a class="btn" href="/workflows/new">New Workflow</a>
    {% endif %}
  </div>
</div>

<div class="filters">
  <span>Filter:</span>
  <a href="/workflows" class="pill {{ '' if status else 'active' }}">All</a>
  <a href="/workflows?status=draft" class="pill {{ 'active' if status=='draft' else '' }}">Draft</a>
  <a href="/workflows?status=submitted" class="pill {{ 'active' if status=='submitted' else '' }}">Submitted</a>
  <a href="/workflows?status=confirmed" class="pill {{ 'active' if status=='confirmed' else '' }}">Confirmed</a>
  <a href="/workflows?status=deprecated" class="pill {{ 'active' if status=='deprecated' else '' }}">Deprecated</a>

  <form method="get" action="/workflows" class="search">
    {% if status %}<input type="hidden" name="status" value="{{ status }}" />{% endif %}
    <input type="text" name="q" value="{{ q or '' }}" placeholder="Search title…" />
    <button class="btn" type="submit">Search</button>
  </form>
</div>

<table class="table">
  <thead>
    <tr>
      <th>Title</th>
      <th>Ver</th>
      <th>Status</th>
      <th>Readiness</th>
    </tr>
  </thead>
  <tbody>
  {% for it in items %}
    <tr>
      <td>
        <a href="/workflows/{{ it.record_id }}/{{ it.latest_version }}">{{ it.title }}</a>
        {% if request.state.role == 'admin' %}
          <div class="muted" style="margin-top:4px">Record: <code>{{ it.record_id[:8] }}…</code></div>
        {% endif %}
      </td>
      <td><code>{{ it.latest_version }}</code></td>
      <td><span class="badge badge-{{ it.status }}">{{ it.status }}</span></td>
      <td>
        {% if it.readiness == 'ready' %}
          <span class="badge badge-confirmed">ready</span>
        {% elif it.readiness == 'awaiting_task_confirmation' %}
          <span class="badge badge-warn">awaiting_task_confirmation</span>
        {% else %}
          <span class="badge badge-deprecated">invalid</span>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
